# 更新日志

所有重要的项目变更都会记录在这个文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [未发布]

### 计划中
- 支持更多阅读应用
- 离线AI模型支持
- 多语言界面
- 云端同步功能

## [1.0.0] - 2024-01-XX

### 新增
- 🎯 智能文本选择检测功能
  - 支持 Supernote Document 应用
  - 支持 Adobe Reader
  - 支持 WPS Office
- 🤖 AI内容分析功能
  - 集成 Google Gemini API
  - 自定义提示模板
  - 智能文本解析和解释
- 🎈 悬浮窗交互界面
  - 优雅的悬浮按钮设计
  - 聊天窗口界面
  - 墨水屏优化显示
- 🔧 辅助功能服务
  - 三层文本提取策略
  - 智能文本过滤
  - 无侵入式文本获取
- 💾 本地数据存储
  - Room 数据库支持
  - 聊天记录保存
  - 历史查询功能
- ⚙️ 设置和配置
  - API Key 管理
  - 自动分析开关
  - 数据清除功能
- 🛠️ 开发工具
  - 构建安装脚本
  - 日志监听工具
  - 调试辅助功能

### 技术特性
- 支持 Android 5.0+ (API 21)
- Kotlin 语言开发
- Material Design 界面
- MVVM 架构模式
- 协程异步处理
- 加密数据存储

### 设备支持
- ✅ Supernote A5 X2 (主要支持)
- ✅ 其他墨水屏设备
- ✅ 普通 Android 设备

### 已知问题
- 部分应用的文本选择检测可能不够精确
- 在某些设备上悬浮窗权限需要手动授予
- AI 分析需要网络连接

---

## 版本说明

### 版本号格式
- **主版本号**：不兼容的 API 修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 变更类型
- **新增** - 新功能
- **变更** - 对现有功能的变更
- **弃用** - 即将移除的功能
- **移除** - 已移除的功能
- **修复** - 问题修复
- **安全** - 安全相关修复

## v1.1.0 (2024-07-13)

### 重大架构重构
- **模块化设计**: 对`FloatingWindowService`进行了全面重构，将近3000行的巨大服务类拆分为7个专注于特定功能的管理器类：
  - `FloatingButtonManager`: 管理悬浮按钮的显示、位置和交互
  - `ChatWindowManager`: 管理聊天窗口的UI和用户交互逻辑
  - `SessionManager`: 管理聊天会话的创建、切换和维护
  - `ScreenshotManager`: 管理截屏功能、权限和图片处理
  - `AiCommunicationManager`: 处理与AI服务的通信和响应处理
  - `AiConfigurationManager`: 管理AI配置、API Key设置和对话框显示
  - `TextSelectionManager`: 处理文本选择、过滤和相关交互
- **服务类重构**:
  - 创建了新的`FloatingWindowServiceNew`服务类，作为各管理器的协调者
  - 通过接口回调机制实现各模块间的通信，降低耦合度
  - 实现了更清晰的生命周期管理
- **用户界面适配**:
  - 更新了`MainActivity`，使用新的`FloatingWindowServiceNew`替代原来的`FloatingWindowService`
  - 保持了完全相同的用户体验，用户无感知迁移

### 性能与架构优化
- **代码质量提升**:
  - 提高了代码的可维护性，每个管理器类只负责一项特定功能
  - 符合单一职责原则(SRP)，降低了代码复杂度
  - 代码结构更加清晰，易于理解和维护
- **开发效率提升**:
  - 各个功能模块之间的依赖关系更加明确
  - 更容易添加新功能或修改现有功能
  - 新功能开发不再需要修改巨大的服务类文件
  - 支持更好的单元测试和模块测试
- **更高的稳定性**:
  - 模块间通过定义良好的接口通信
  - 代码复用性更高，减少了冗余代码
  - 各模块状态管理更加清晰
  - 错误处理更加集中和统一

## v1.0.0 (2023-06-01)

### 初始版本
- 发布ReadAssist应用的第一个正式版本
- 实现了悬浮按钮、聊天窗口、截屏分析等基本功能
- 支持Google Gemini和SiliconFlow两种AI服务
- 支持文本选择和截屏分析
- 实现了聊天历史记录的保存和查看 